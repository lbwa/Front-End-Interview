(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{151:function(t,s,n){t.exports=n.p+"assets/img/mvvm-vue.78995808.png"},152:function(t,s,n){t.exports=n.p+"assets/img/mvvm.4d341735.png"},154:function(t,s,n){"use strict";n.r(s);var a=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"mvvm-架构模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mvvm-架构模式","aria-hidden":"true"}},[this._v("#")]),this._v(" MVVM 架构模式")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"对-mvvm-的理解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对-mvvm-的理解","aria-hidden":"true"}},[this._v("#")]),this._v(" 对 MVVM 的理解")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("li",[a("p",[t._v("定义")]),a("ul",[a("li",[a("p",[a("code",[t._v("Model")]),t._v(" 数据模型，一般是 "),a("code",[t._v("JavaScript")]),t._v(" 对象，用于存储业务数据。")])]),a("li",[a("p",[a("code",[t._v("ViewModel")]),t._v(" 视图模型，如 "),a("code",[t._v("Vue.js")]),t._v(" 。其中包含视图展示逻辑、数据状态等一系列必要因素。")])]),a("li",[a("p",[a("code",[t._v("View")]),t._v(" 视图层，即 "),a("code",[t._v("DOM")]),t._v(" 树。")]),a("p",[a("img",{attrs:{src:n(152),alt:"mvvm-intro"}})])])]),a("p",[t._v("注：如在 "),a("code",[t._v("Vue.js")]),t._v(" 中，通过 "),a("code",[t._v("DOM listener")]),t._v(" 监听 "),a("code",[t._v("View")]),t._v(" 变化来通知 "),a("code",[t._v("ViewModel")]),t._v(" 更新 "),a("code",[t._v("Model")]),t._v("，"),a("code",[t._v("Model")]),t._v(" 通过 "),a("code",[t._v("数据绑定")]),t._v("（"),a("code",[t._v("Data binding")]),t._v("）来通知 "),a("code",[t._v("ViewModel")]),t._v(" 操作 "),a("code",[t._v("DOM")]),t._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("响应式原理是为了在 "),s("code",[this._v("web")]),this._v(" 应用被渲染的数据发生改变时，自行以最优解对目标节点进行更新。或者视图发生变化时，通知 "),s("code",[this._v("Model")]),this._v(" 进行数据修改。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[t._v("模板引擎")]),n("ul",[n("li",[n("p",[t._v("模板的语法与普通 "),n("code",[t._v("HTML")]),t._v(" 语法相近。")])]),n("li",[n("p",[t._v("相较于 "),n("code",[t._v("HTML")]),t._v(" 的静态特性，模板是动态的，模板能够实现逻辑（如 "),n("code",[t._v("v-for")]),t._v("、"),n("code",[t._v("v-if")]),t._v("）并且能够内嵌 JS 变量。")])])]),n("blockquote",[n("p",[t._v("编译逻辑：模板（字符串） => 转换为 js 代码实现逻辑和变量 => HTML")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("渲染（"),s("code",[this._v("ViewModel")]),this._v(" 中的视图展示逻辑）")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[n("code",[t._v("ViewModel")]),t._v(" 中的视图展示逻辑通过 "),n("code",[t._v("render")]),t._v(" 函数来实现，其中 "),n("code",[t._v("render")]),t._v(" 函数的"),n("strong",[t._v("核心")]),t._v("是 "),n("code",[t._v("vdom")]),t._v("。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[t._v("传统 JS 库（如 "),n("code",[t._v("jQuery")]),t._v("）与 "),n("code",[t._v("MVVM")]),t._v(" 框架的差异")]),n("p",[t._v("最大的区别就是 "),n("code",[t._v("MVVM")]),t._v(" 框架实现了 "),n("strong",[t._v("关注点分离")]),t._v("。")]),n("ul",[n("li",[n("p",[t._v("使用传统 JS 框架或原生 JS 开发时：")]),n("ul",[n("li",[n("p",[t._v("必须同时顾及业务逻辑实现与 "),n("code",[t._v("DOM")]),t._v(" 操作最优解。即数据模型与视图层混杂在一起，"),n("strong",[t._v("形成耦合")]),t._v("。即"),n("strong",[t._v("关注点混杂")]),t._v("，后期应用拓展常常需要兼顾之前的模块逻辑，违背开放封闭原则。")])]),n("li",[n("p",[t._v("当 "),n("code",[t._v("web")]),t._v(" 应用后期拓展到一定复杂度后，其中的复杂的 "),n("code",[t._v("DOM")]),t._v(" 操作将可能带来巨大的性能消耗。后期的拓展和维护也将要付出昂贵的成本，每一次拓展和维护都要顾及对之前的 "),n("code",[t._v("DOM")]),t._v(" 树的影响。")])]),n("li",[n("p",[t._v("因为前期不需要搭建额外的视图模型（"),n("code",[t._v("ViewModel")]),t._v("，视图层与数据模型之间通信的桥梁），那么在小型简单 "),n("code",[t._v("web")]),t._v(" 应用开发方面传统 JS 框架或原生 JS 开发仍保持着开发流程简洁的优势。")])])])]),n("li",[n("p",[n("code",[t._v("MVVM")]),t._v(" 框架通过建立一个 "),n("code",[t._v("视图模型 ViewModel")]),t._v(" 来解耦 "),n("code",[t._v("数据模型 Model")]),t._v(" 和 "),n("code",[t._v("视图层 View")]),t._v("：")]),n("ul",[n("li",[n("p",[n("strong",[t._v("建立视图模型（"),n("code",[t._v("ViewModel")]),t._v("）中间层")]),t._v("用于数据模型与视图层的通信，使得后期拓展更易遵循开放封闭原则。")])]),n("li",[n("p",[n("strong",[t._v("以数据驱动视图更新")]),t._v("，只关心数据模型的变化，DOM 操作被封装。开发人员只需要专注 JS 逻辑的实现即可。并不需要直接接触真实 "),n("code",[t._v("DOM")]),t._v("，"),n("code",[t._v("MVVM")]),t._v(" 框架会自行通过 "),n("code",[t._v("web")]),t._v(" 应用的数据来驱动真实 "),n("code",[t._v("DOM")]),t._v(" 的渲染。所有真实 "),n("code",[t._v("DOM")]),t._v(" 树的更新都是依靠 "),n("code",[t._v("ViewModel")]),t._v(" 来实施高效的页面渲染和更新。")])])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"实现-mvvm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现-mvvm","aria-hidden":"true"}},[this._v("#")]),this._v(" 实现 MVVM")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("（以 "),s("code",[this._v("Vue.js")]),this._v(" 为例）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-vue-js-中响应式原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-vue-js-中响应式原理","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. Vue.js 中响应式原理")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-vue-js-如何解析模板"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-vue-js-如何解析模板","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. Vue.js 如何解析模板")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[t._v("模板")]),n("ol",[n("li",[n("p",[t._v("本质：字符串")])]),n("li",[n("p",[t._v("内含"),n("strong",[t._v("逻辑")]),t._v("语句，如 "),n("code",[t._v("v-if")]),t._v("、"),n("code",[t._v("v-for")]),t._v(" 等语句")])]),n("li",[n("p",[t._v("对比静态的 "),n("code",[t._v("HTML")]),t._v("，模板是"),n("strong",[t._v("动态")]),t._v("的。")])]),n("li",[n("p",[t._v("最终的编译结果是 "),n("code",[t._v("HTML")]),t._v("。")]),n("ul",[n("li",[n("p",[t._v("模板必须转换为 JS 代码来实现模板中的"),n("strong",[t._v("逻辑")]),t._v("语句和引用的 JS "),n("strong",[t._v("变量")]),t._v("。")]),n("ul",[n("li",[t._v("前端三大语言中只有 JS 具有逻辑实现，即图灵完备语言。")])])]),n("li",[n("p",[t._v("三大语言中只有 JS （"),n("code",[t._v("render")]),t._v(" 函数）能实现将字符串转换为 "),n("code",[t._v("HTML")]),t._v("。")])])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("render")]),this._v(" 函数")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[t._v("模板中的所有信息在 "),n("code",[t._v("render")]),t._v(" 函数中均有体现")]),n("ul",[n("li",[t._v("模板如下：")])]),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("class")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("app"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("{{name}}"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("ul",[n("li",[n("code",[t._v("render")]),t._v(" 函数体如下：")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// with 用于指定 with 代码块中的上一级作用域，在查询当前作用域中未声明变量的声明时，起作用")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// this 指向 vue 实例 vm")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("with")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// _c 即 vm._c，调用 createElement()，即创建 vnode")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("_c")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{attrs:{class:"token string"}},[t._v("'div'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      attrs"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token string"}},[t._v("'id'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'app'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// name 即 vm.name 即 vm._data.name")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// vm._v 即 createTextVNode(val)，创建 文本 vnode")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// vm._s 即 toString(val)，转换变量 name 为字符串")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("_c")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'p'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token function"}},[t._v("_v")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("_s")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br")])]),n("p",[t._v("注：暂只关心设计理念，模板转换为 JS 代码（"),n("code",[t._v("render")]),t._v(" 函数）的过程属于工具化细节，暂不过多纠结。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[n("code",[t._v("Vue.js")]),t._v(" 指令实现")]),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("v-model")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("msg"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("@keyup.enter")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("submit"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("type")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("id")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("inputPanel"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 拦截 Vue.js 源码中 `code.render` 可以得到当前模板转换后的 render 函数")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// this 即为 vm")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("_c")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{attrs:{class:"token string"}},[t._v("'input'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      directives"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          name"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"model"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          rawName"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"v-model"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// v-model 绑定的值")]),t._v("\n          value"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          expression"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"msg"')]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n      "),n("span",{attrs:{class:"token comment"}},[t._v("// HTML 标签字符串的属性")]),t._v("\n      attrs"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v('"type"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"text"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v('"id"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"inputPanel"')]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// DOM 树对象（由浏览器转换 HTML 字符串而来）自身的属性")]),t._v("\n      domProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// DOM 绑定 vm.msg")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 即当赋值 vm.msg 时，DOM 会做出相应改变")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v('"value"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// 监听事件")]),t._v("\n      on"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v('"keyup"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("!")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'button'")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v(" $event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("_k")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keyCode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"enter"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("13")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v('"Enter"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("submit")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 由 v-model 指令添加的 input 事件监听")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v('"input"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("composing"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{attrs:{class:"token comment"}},[t._v("// 当输入事件触发时，设置 vm.msg 的值")]),t._v("\n          msg "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" $event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br")])]),n("ul",[n("li",[n("p",[t._v("v-model 实现")]),n("p",[n("code",[t._v("v-model")]),t._v(" 指令本质是一个语法糖，他是监听 "),n("code",[t._v("DOM")]),t._v(" 树对象属性和监听 "),n("code",[t._v("input")]),t._v(" 事件的封装。")]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("domProps"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 即 document.querySelector('input').value = msg")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v('"value"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\non"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// 此处亦是 v-on 的实现")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v('"input"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("composing"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 当输入事件触发时，设置 vm.msg 的值")]),t._v("\n    msg "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" $event"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),n("li",[n("p",[n("code",[t._v("v-for")]),t._v(" 实现")]),n("p",[n("code",[t._v("v-for")]),t._v(" 本质是 "),n("code",[t._v("for 循环")]),t._v(" 得到目标元素的 "),n("code",[t._v("render")]),t._v(" 函数所构成的数组，该数组可用于父 "),n("code",[t._v("render")]),t._v(" 函数中。")]),n("p",[t._v("（"),n("code",[t._v("v-if")]),t._v(" 本质是 "),n("code",[t._v("if 语句判断")]),t._v("）")]),n("p",[t._v("模板如下：")]),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ul")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("li")]),t._v(" "),n("span",{attrs:{class:"token attr-name"}},[t._v("v-for")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("item in items"),n("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("{{item}}"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("li")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("ul")]),n("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[n("code",[t._v("render")]),t._v(" 函数如下：")]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[t._v("_c")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'ul'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// vm._l 即 renderList 函数")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 返回一个每项均为 li 的 render 函数的数组")]),t._v("\n  "),n("span",{attrs:{class:"token function"}},[t._v("_l")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("items"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("_c")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v("'li'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n          "),n("span",{attrs:{class:"token function"}},[t._v("_v")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("_s")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br")])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("render")]),this._v(" 函数（"),s("code",[this._v("vm._c")]),this._v("）逻辑")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Vue.js")]),this._v(" 中的 "),s("code",[this._v("render")]),this._v(" 函数是由 "),s("code",[this._v("snabbdom")]),this._v(" 演变而来。如他们的传参方式。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/**\n * 1. src/core/instance/lifecycle.js 定义 Vue.prototype._update = function () {}\n * 2. vm._update 用于对比新旧 vnode 的差异\n */")]),t._v("\nvm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("_update")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 在对比新旧 vnode 之前，缓存旧的 vnode")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" prevVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 缓存新的 vnode，用于下一次对比")]),t._v("\n  vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_vnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" vnode\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token operator"}},[t._v("!")]),t._v("prevVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 初次渲染，挂载到 vm.$el 上，并渲染出真实 DOM，并形成 DOM 映射")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// vm.__patch__ 即如同 snabbdom 中的 patch 函数")]),t._v("\n    vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("__patch__")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 将新 vnode 对比旧的 vnode 得到差异并根据 DOM 映射进行 DOM 更新")]),t._v("\n    vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$el "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("__patch__")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prevVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("/**\n * 1. src/core/instance/lifecycle.js 定义\n * 2. 仅用于 Watcher 实例中\n * 结合响应式原理：\n * vm.$data[someData] 的 setter\n * --\x3e dep.notify()\n * --\x3e subs[i].update()\n * --\x3e updateComponent\n * --\x3e vm._render\n */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("updateComponent")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// vm._render() 即 render 函数，即 vm._c，调用后将返回一个新的 vnode")]),t._v("\n  vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("_update")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("_render")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-vue-js-实现的整体流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-vue-js-实现的整体流程","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. Vue.js 实现的整体流程")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[t._v("解析模板为 JS 代码实现模板中的逻辑，并构建 "),n("code",[t._v("render")]),t._v(" 函数")]),n("ul",[n("li",[n("p",[t._v("实现 "),n("code",[t._v("v-if")]),t._v("、"),n("code",[t._v("v-for")]),t._v("、"),n("code",[t._v("v-on")]),t._v(" 等模板中的逻辑语句。")])]),n("li",[n("p",[t._v("构建 "),n("code",[t._v("render")]),t._v(" 函数，并得到 "),n("code",[t._v("vdom")]),t._v("，"),n("code",[t._v("vdom")]),t._v(" 与将真实 "),n("code",[t._v("DOM")]),t._v(" 树形成映射。")])])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("重写 "),n("code",[t._v("数据对象")]),t._v("（如 "),n("code",[t._v("vm.$data[dataName]")]),t._v("） 的 "),n("code",[t._v("getter")]),t._v(" 和 "),n("code",[t._v("setter")]),t._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("getter")]),t._v(" 添加 "),n("code",[t._v("收集依赖")]),t._v(" 方法 "),n("code",[t._v("dep.depend()")]),t._v("，使其"),n("strong",[t._v("选择性")]),t._v("在依赖收集容器 "),n("code",[t._v("dep.subs")]),t._v(" 中添加数据依赖 "),n("code",[t._v("Watcher")]),t._v("，以避免不必要的渲染。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("之所以建立 "),n("code",[t._v("dep.depend()")]),t._v("，是为了只为 "),n("strong",[t._v("参与构建")]),n("code",[t._v("DOM")]),t._v(" 的数据对象 "),n("code",[t._v("$data[someData]")]),t._v(" 提供数据依赖。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[n("code",[t._v("setter")]),t._v(" 添加 "),n("code",[t._v("更新依赖")]),t._v(" 函数 "),n("code",[t._v("dep.notify()")]),t._v("，使其在变化时触发依赖收集更新。")]),n("ul",[n("li",[t._v("在 "),n("code",[t._v("setter")]),t._v(" 中触发更新依赖函数时，未参与构建 "),n("code",[t._v("DOM")]),t._v(" 中的数据对象容器是没有数据依赖的（即 "),n("code",[t._v("dep.subs")]),t._v(" 为空数组），即不会触发后续的一系列更新 "),n("code",[t._v("DOM")]),t._v(" 的方法，即"),n("strong",[t._v("避免了不必要的重复渲染")]),t._v("。")])])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("注："),n("code",[t._v("Vue.js")]),t._v(" 中数据依赖都是以 "),n("code",[t._v("Watcher")]),t._v(" 的实例为形式存储的（"),n("code",[t._v("subs")]),t._v(" 数组），"),n("code",[t._v("Watcher")]),t._v(" 存在一个原型方法 "),n("code",[t._v("update")]),t._v("。"),n("code",[t._v("update")]),t._v(" 方法在被调用时，将调用 "),n("code",[t._v("Vue")]),t._v(" 的原型方法 "),n("code",[t._v("_render")]),t._v("（即 "),n("code",[t._v("render")]),t._v(" 函数）。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("li",[n("p",[t._v("在 "),n("code",[t._v("Vue.js")]),t._v(" 中将 "),n("code",[t._v("data")]),t._v(" 选项中的属性代理到 "),n("code",[t._v("Vue")]),t._v(" 实例下。")]),n("ul",[n("li",[t._v("因为在 "),n("code",[t._v("render")]),t._v(" 函数中指定了 "),n("code",[t._v("with")]),t._v(" 作用域都是在 "),n("code",[t._v("Vue")]),t._v(" 实例下，而不是 "),n("code",[t._v("data")]),t._v(" 之类的选项中，那么此处的数据代理是必不可少的。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("p",[s("code",[this._v("DOM listener")]),this._v(" 监听 "),s("code",[this._v("View")]),this._v(" 层的 "),s("code",[this._v("DOM")]),this._v(" 树对象属性的变化。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",{attrs:{start:"3"}},[a("li",[a("p",[t._v("首次渲染，且绑定依赖")]),a("ul",[a("li",[a("p",[t._v("将 "),a("code",[t._v("render")]),t._v(" 函数渲染成真实 "),a("code",[t._v("DOM")]),t._v("。")]),a("ul",[a("li",[t._v("执行 "),a("code",[t._v("render")]),t._v(" 函数实现初次 "),a("code",[t._v("DOM")]),t._v(" 渲染。")])]),a("blockquote",[a("p",[a("code",[t._v("updateComponent")]),t._v(" --\x3e "),a("code",[t._v("vm._render")]),t._v(" --\x3e "),a("code",[t._v("vm.__patch__(vm.$el, vnode)")]),t._v(" --\x3e 生成 "),a("code",[t._v("DOM")]),t._v(" 树")])]),a("ul",[a("li",[t._v("缓存当次的 "),a("code",[t._v("vnode")]),t._v(" 为 "),a("code",[t._v("vm._vnode")]),t._v(" 以用于下次 "),a("code",[t._v("vm.__patch__(vnode, prevVnode)")]),t._v(" 成为 "),a("code",[t._v("prevVnode")]),t._v(" 对比新的 "),a("code",[t._v("vnode")]),t._v("。")])])]),a("li",[a("p",[t._v("绑定依赖")]),a("ul",[a("li",[t._v("在执行 "),a("code",[t._v("render")]),t._v(" 函数时，就会访问到 "),a("code",[t._v("数据对象")]),t._v("（因为先前在模板中使用了代表 "),a("code",[t._v("数据对象")]),t._v(" 的变量，需要将变量转化为 "),a("code",[t._v("DOM")]),t._v(" 节点），就会触发 "),a("code",[t._v("2")]),t._v(" 中的响应式机制，即触发 "),a("code",[t._v("getter")]),t._v(" 函数中的 "),a("code",[t._v("dep.depend()")]),t._v("，那么就会只对 "),a("strong",[t._v("参与构建")]),a("code",[t._v("DOM")]),t._v(" 树的 "),a("code",[t._v("数据对象")]),t._v(" 开始收集数据依赖并存储于容器中。")])])])])]),a("li",[a("p",[t._v("响应式机制的依赖发生变化时将触发 "),a("code",[t._v("re-render")])]),a("ul",[a("li",[a("code",[t._v("Model")]),t._v(" 层发生变化")])]),a("blockquote",[a("p",[a("code",[t._v("vm.$data[dataName]")]),t._v(" 的 "),a("code",[t._v("setter")]),t._v(" --\x3e "),a("code",[t._v("dep.notify()")]),t._v(" --\x3e "),a("code",[t._v("subs[i].update()")]),t._v(" --\x3e "),a("code",[t._v("updateComponent")]),t._v(" --\x3e "),a("code",[t._v("vm._render")]),t._v(" --\x3e "),a("code",[t._v("vdom")]),t._v(" 中的 "),a("code",[t._v("vm.__patch__(vnode, prevVnode)")]),t._v(" --\x3e 更新 "),a("code",[t._v("DOM")])])]),a("ul",[a("li",[a("p",[t._v("补充："),a("code",[t._v("View")]),t._v(" 层发生变化")]),a("p",[a("code",[t._v("View")]),t._v(" 层将通知 "),a("code",[t._v("ViewModel")]),t._v(" 以更新对应 "),a("code",[t._v("Model")]),t._v(" 中的值。")]),a("p",[a("img",{attrs:{src:n(151),alt:"mvvm-mind-map"}})])])])])])}],e=n(0),v=Object(e.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._m(1),n("ol",[t._m(2),n("li",[n("p",[n("code",[t._v("MVVM")]),t._v(" 框架（"),n("code",[t._v("Model-View-ViewModel")]),t._v("（"),n("a",{attrs:{href:"https://zh.wikipedia.org/wiki/MVVM",target:"_blank",rel:"noopener noreferrer"}},[t._v("wiki"),n("OutboundLink")],1),t._v("））三要素")]),n("ul",[n("li",[n("p",[t._v("响应式（👉Repo: "),n("a",{attrs:{href:"https://github.com/lbwa/vue-reactive",target:"_blank",rel:"noopener noreferrer"}},[t._v("演示"),n("OutboundLink")],1),t._v("）")]),t._m(3)]),t._m(4),n("li",[t._m(5),n("ul",[t._m(6),n("li",[n("p",[n("code",[t._v("vdom")]),t._v(" 借由 "),n("code",[t._v("diff")]),t._v(" 算法可以在操作 "),n("code",[t._v("DOM")]),t._v(" 时带来极低的性能消耗（原因：章节 - "),n("router-link",{attrs:{to:"./../adv-virtual-dom.html"}},[t._v("Virtual DOM")]),t._v("）。")],1)])])])])]),t._m(7)]),t._m(8),t._m(9),t._m(10),n("p",[t._v("（👉Repo: "),n("a",{attrs:{href:"https://github.com/lbwa/vue-reactive",target:"_blank",rel:"noopener noreferrer"}},[t._v("演示"),n("OutboundLink")],1),t._v("）")]),t._m(11),n("ol",[t._m(12),n("li",[t._m(13),n("ol",[t._m(14),t._m(15),n("li",[t._m(16),t._m(17),n("ul",[n("li",[n("p",[n("code",[t._v("vm._c")]),t._v(" 即相当于 "),n("code",[t._v("snabbdom")]),t._v(" 中的 "),n("code",[t._v("h")]),t._v(" 函数（API 见章节 - "),n("router-link",{attrs:{to:"./../adv-virtual-dom.html"}},[t._v("Virtual DOM")]),t._v("），最终将创建一个 "),n("code",[t._v("vnode")]),t._v("。")],1),t._m(18)])])])])])]),t._m(19),n("ol",[t._m(20),n("li",[n("p",[t._v("形成响应式机制")]),n("ul",[n("li",[t._m(21),n("ul",[n("li",[t._m(22),n("ul",[n("li",[t._m(23),n("ul",[n("li",[t._v("实现逻辑：添加当前 "),n("code",[t._v("Watcher")]),t._v(" 实例（即数据依赖）到当前数据依赖存储容器 "),n("code",[t._v("dep.subs")]),t._v(" 中（"),n("a",{attrs:{href:"https://github.com/lbwa/vue-reactive#watcher",target:"_blank",rel:"noopener noreferrer"}},[t._v("详细"),n("OutboundLink")],1),t._v("）。")])])]),n("li",[n("p",[t._v("每个 "),n("code",[t._v("数据对象")]),t._v(" 都有一个独享的 "),n("code",[t._v("dep")]),t._v(" 实例，它是以"),n("strong",[t._v("闭包变量")]),t._v("的形式与"),n("strong",[t._v("每个")]),n("code",[t._v("数据对象")]),t._v(" 相关联（"),n("a",{attrs:{href:"https://github.com/lbwa/vue-reactive/blob/master/reactive.js#L8",target:"_blank",rel:"noopener noreferrer"}},[t._v("示例"),n("OutboundLink")],1),t._v("）。")])])])]),t._m(24)]),t._m(25)]),t._m(26),t._m(27)])])]),t._m(28)])},a,!1,null,null,null);s.default=v.exports}}]);