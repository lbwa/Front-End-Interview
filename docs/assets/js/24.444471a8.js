(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{155:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"virtual-dom"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#virtual-dom","aria-hidden":"true"}},[s._v("#")]),s._v(" virtual DOM")]),n("p",[s._v("一般将 "),n("code",[s._v("virtual DOM")]),s._v(" 简写为 "),n("code",[s._v("vdom")]),s._v("。"),n("code",[s._v("vdom")]),s._v(" 的目的是以最优解去更新 "),n("code",[s._v("DOM")]),s._v("，那么就要保证更新节点的查询次数最少（"),n("code",[s._v("vnode")]),s._v("更新节点不需要查询），更新的影响范围最小（依靠 "),n("code",[s._v("vnode.elm")]),s._v(" 精确定位节点）。")]),n("h2",{attrs:{id:"vdom-定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vdom-定义","aria-hidden":"true"}},[s._v("#")]),s._v(" vdom 定义")]),n("ol",[n("li",[n("p",[s._v("含义：用 JS 对象来映射模拟 "),n("code",[s._v("DOM")]),s._v(" 结构")]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("h")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'div'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" id"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'test'")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'hello'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 生成 vnode")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  children"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" undefined"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 数组，表示当前节点的 Element 类型子节点的子 vnode")]),s._v("\n  data"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 当前节点的属性")]),s._v("\n    id"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'data'")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  elm"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" div"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 映射真实 DOM 树节点，即此处是 vdom 精确更新修改后节点的关键之一")]),s._v("\n  key"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" undefined"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  sel"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'div'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// h() 第一参数，用于创建真实节点")]),s._v("\n  text"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'hello'")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 当前节点的文本节点，与 children 属性互斥")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])]),n("li",[n("p",[s._v("原理：在 JS 层通过 "),n("code",[s._v("diff")]),s._v(" 算法来对比 "),n("code",[s._v("DOM")]),s._v(" 的结构变化")]),n("ul",[n("li",[n("p",[s._v("浏览器中最"),n("strong",[s._v("耗时")]),s._v("的操作即是 "),n("code",[s._v("DOM")]),s._v(" 操作，直接操作 "),n("code",[s._v("DOM")]),s._v("，将带来巨大的性能开销，所以在没有使用 "),n("code",[s._v("vdom")]),s._v(" 时，需要我们尽可能减少 "),n("code",[s._v("DOM")]),s._v(" 操作。")])]),n("li",[n("p",[s._v("JS 的执行速度"),n("strong",[s._v("远远快于")]),s._v("浏览器 "),n("code",[s._v("DOM")]),s._v(" 渲染速度。所以在 JS 层来处理 "),n("code",[s._v("DOM")]),s._v(" 结构变化将大大降低性能开销。结果将是以"),n("strong",[s._v("最优解")]),s._v("（最小的改动范围，最少的改动次数）去改变 "),n("code",[s._v("DOM")]),s._v(" 结构。")]),n("ul",[n("li",[n("p",[s._v("借助 "),n("code",[s._v("diff")]),s._v(" 算法对比新旧 "),n("code",[s._v("vnode")]),s._v(" 的差异。")])]),n("li",[n("p",[n("code",[s._v("vnode.elm")]),s._v(" 与真实 "),n("code",[s._v("DOM")]),s._v(" 树节点形成映射，进行"),n("strong",[s._v("精准更新")]),s._v("，避免了 "),n("code",[s._v("DOM")]),s._v(" 节点查询。")])])])]),n("li",[n("p",[s._v("前端中只有 JS 是图灵完备语言 —— 能执行算法的语言")])])])]),n("li",[n("p",[s._v("目的：提高重绘性能。即是 "),n("code",[s._v("vdom")]),s._v(" 存在的意义。")])])]),n("h2",{attrs:{id:"vdom-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vdom-api","aria-hidden":"true"}},[s._v("#")]),s._v(" vdom API")]),n("ul",[n("li",[n("p",[s._v("核心：")]),n("ul",[n("li",[n("p",[n("code",[s._v("h")]),s._v(" 函数：生成 "),n("code",[s._v("vnode")]),s._v("。")])]),n("li",[n("p",[n("code",[s._v("patch")]),s._v(" 函数：对比新旧 "),n("code",[s._v("vnode")]),s._v("，并生成或更新 "),n("code",[s._v("DOM")]),s._v(" 节点。")])])])])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("// const snabbdom = require('sanbbdom')")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'snabbdom'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" h "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'snabbdom/h'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_class "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/class'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_props "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/props'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_style "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/style'")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_eventlistener "),n("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/eventlistener'")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 初始化 patch")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" patch "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" snabbdom"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("init")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  snabbdom_class"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  snabbdom_props"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  snabbdom_style"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  snabbdom_eventlisteners\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 生成 vnode")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("h")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),n("span",{attrs:{class:"token comment"}},[s._v("/* 标签名 */")]),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token comment"}},[s._v("/* 属性 */")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token comment"}},[s._v("/* 子元素 */")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("h")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),n("span",{attrs:{class:"token comment"}},[s._v("/* 标签名 */")]),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token comment"}},[s._v("/* 属性 */")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[s._v("`")]),n("span",{attrs:{class:"token interpolation"}},[n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),n("span",{attrs:{class:"token comment"}},[s._v("/* 文本节点 */")]),n("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{attrs:{class:"token string"}},[s._v("`")])]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("// 生成并修改 DOM")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" container "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("querySelector")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'#container'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{attrs:{class:"token function"}},[s._v("patch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// vnode 初次渲染至 container 容器中")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("patch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 利用 js 对比新旧 vnode 来得到操作 DOM 的最优解")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("以下示例如何生成一个 "),n("code",[s._v("table")]),s._v(" 表格：")]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" data "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'name'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    age"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'age'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    address"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'address'")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'John Wick'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    age"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token number"}},[s._v("20")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    address"),n("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v("'Shanghai'")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" vnode "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("// 缓存容器")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("render")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 生成 vnode")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newVnode "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("h")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'table'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("map")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tds "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("keys")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      tds"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("push")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("h")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'td'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" item"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 返回一个以 tr 元素的 vnode 组成的数组")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("h")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token string"}},[s._v("'tr'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tds"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("patch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token function"}},[s._v("patch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 缓存 vnode")]),s._v("\n  vnode "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newVnode\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token function"}},[s._v("render")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("p",[s._v("得到表格如下：")]),n("table",[n("thead",[n("tr",[n("th",[s._v("name")]),n("th",[s._v("age")]),n("th",[s._v("address")])])]),n("tbody",[n("tr",[n("td",[s._v("John Wick")]),n("td",[s._v("20")]),n("td",[s._v("Shanghai")])])])]),n("p",[n("code",[s._v("DOM")]),s._v(" 树如下：")]),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),n("span",{attrs:{class:"token attr-name"}},[s._v("id")]),n("span",{attrs:{class:"token attr-value"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("=")]),n("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("container"),n("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("table")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("tr")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("name"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("age"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("address"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("tr")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("tr")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("John Wick"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("20"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Shanghai"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("tr")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("table")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token tag"}},[n("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),n("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h2",{attrs:{id:"diff-算法-——-vdom-核心"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diff-算法-——-vdom-核心","aria-hidden":"true"}},[s._v("#")]),s._v(" diff 算法 —— vdom 核心")]),n("ol",[n("li",[n("p",[s._v("定义")]),n("ul",[n("li",[n("p",[n("code",[s._v("linux")]),s._v(" 中的 "),n("code",[s._v("diff")]),s._v(" 命令。")]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("diff")]),s._v(" a.js a1.js\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 将打印 a.js 与 a1.js 的差异")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),n("li",[n("p",[n("code",[s._v("diff")]),s._v(" 算法并非 "),n("code",[s._v("vdom")]),s._v(" 的原创算法。")])])])]),n("li",[n("p",[n("code",[s._v("vdom")]),s._v(" 使用 "),n("code",[s._v("diff")]),s._v(" 算法的原因")]),n("ul",[n("li",[s._v("依靠 "),n("code",[s._v("diff")]),s._v(" 算法，可以"),n("strong",[s._v("找到")]),s._v("新旧 "),n("code",[s._v("vnode")]),s._v(" 中的差异点，即是必须更新的节点（依据 "),n("code",[s._v("vnode.elm")]),s._v(" 得到映射的真实 "),n("code",[s._v("DOM")]),s._v(" 树节点进更新），而其他节点则保持不变。")])])]),n("li",[n("p",[n("code",[s._v("diff")]),s._v(" 算法核心实现流程")]),n("ul",[n("li",[n("p",[s._v("初次渲染，将 "),n("code",[s._v("vnode")]),s._v(" 初次转换成 "),n("code",[s._v("DOM")]),s._v(" 节点")]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("patch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("// 仅用于体现转换逻辑，并非真实体现")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("createElement")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tag "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sel\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" attrs "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data "),n("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" children "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),n("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("tag"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 创建元素")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ele "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("createElement")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tag"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 设置节点属性")]),s._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("keys")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ele"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("setAttribute")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" attrs"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("item"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 插入子元素")]),s._v("\n  children"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token comment"}},[s._v("// 递归创建子节点的后代节点（若有的话）")]),s._v("\n    ele"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("appendChild")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token function"}},[s._v("createElement")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// 返回真正 DOM 节点")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" ele\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("以上逻辑主要展现 "),n("code",[s._v("vnode")]),s._v(" 的初次渲染。于 "),n("code",[s._v("patch")]),s._v(" 方法中， "),n("code",[s._v("container")]),s._v(" 为渲染容器。")])]),n("li",[n("p",[s._v("渲染更新")]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("patch")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("updateChildren")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" children "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),n("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newChildren "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),n("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  children"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{attrs:{class:"token function"}},[s._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" index"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newChildVnode "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newChildren"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("index"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sel "),n("span",{attrs:{class:"token operator"}},[s._v("===")]),s._v(" newChildVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sel"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token comment"}},[s._v("// 递归子节点的后代节点进行对比")]),s._v("\n      "),n("span",{attrs:{class:"token function"}},[s._v("updateChildren")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode newChildVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{attrs:{class:"token function"}},[s._v("replaceNode")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newChildVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("replaceNode")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" elm "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("elm\n  "),n("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newElm "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("createElement")]),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newVnode"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[s._v("// DOM 替换 ...")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[s._v("以上逻辑主要展现 "),n("code",[s._v("vnode")]),s._v(" 更新。在得到 "),n("code",[s._v("newVnode")]),s._v(" 后传入 "),n("code",[s._v("patch")]),s._v(" 函数，"),n("code",[s._v("patch")]),s._v(" 函数将根据 "),n("code",[s._v("diff")]),s._v(" 算法得到 "),n("code",[s._v("vnode")]),s._v(" 与 "),n("code",[s._v("newVnode")]),s._v(" 之间的差异，之后执行精确的 "),n("code",[s._v("DOM")]),s._v(" 更新。")])])])])])])}],!1,null,null,null);t.default=e.exports}}]);