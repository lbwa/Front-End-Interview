(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{147:function(t,s,a){t.exports=a.p+"assets/img/Set-CORS1.9800b73f.png"},148:function(t,s,a){t.exports=a.p+"assets/img/Set-CORS.f1a21c43.png"},149:function(t,s,a){t.exports=a.p+"assets/img/No-CORS.bd5044d8.png"},179:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"ajax"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ajax","aria-hidden":"true"}},[this._v("#")]),this._v(" Ajax")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"xmlhttprequest"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xmlhttprequest","aria-hidden":"true"}},[this._v("#")]),this._v(" XMLHttpRequest")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 第三个参数（Boolean）为是否异步执行请求，即待服务器响应后再继续执行 Ajax 接下来的代码")]),t._v("\nxhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("open")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'GET'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'https://api.github.com'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 异步回调")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("4")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" xhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("300")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" xhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("304")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token template-string"}},[a("span",{attrs:{class:"token string"}},[t._v("`Request was unsuccessful : ")]),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("xhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{attrs:{class:"token string"}},[t._v("`")])]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nxhr"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("send")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("null")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"状态码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#状态码","aria-hidden":"true"}},[this._v("#")]),this._v(" 状态码")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("2XX - Success - 表示成功处理请求。如 200。")])]),s("li",[s("p",[this._v("3XX - Redirection - 需要重定向，浏览器直接跳转。")])]),s("li",[s("p",[this._v("4XX - Client Error - 客户端请求错误。")])]),s("li",[s("p",[this._v("5XX - Server Error - 服务端响应错误。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"客户端跨域"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端跨域","aria-hidden":"true"}},[this._v("#")]),this._v(" 客户端跨域")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"跨域的定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域的定义","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨域的定义")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("客户端为因安全问题，会默认"),s("strong",[this._v("阻止解析（并不阻止请求，这也是 CORS 的原理）")]),this._v(" Ajax 请求的非同源（请求地址的协议、域名、端口任意一项与当前页面不同）资源。即浏览器并不会阻止 Ajax 跨域请求，阻止的是解析 Ajax 跨域请求返回的数据。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(149),alt:"NO-CORS"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上图中，请求地址是非同源地址，由 "),s("code",[this._v("response")]),this._v(" 可看出客户端并未阻止跨域 Ajax 请求，但是浏览器在服务端返回数据后进行 "),s("code",[this._v("Access-Control-Allow-Origin")]),this._v(" 验证时，发现当前源（"),s("code",[this._v("http://localhost:8889")]),this._v("）并没有跨域权限（没有在服务端的白名单中）中，故浏览器拒绝解析服务端返回给客户端的数据，此时的客户端是已经接受了跨域请求的数据了的，只是客户端拒绝解析。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("浏览器默认执行"),s("strong",[this._v("同源策略")]),this._v("。即只会解析与当前源对比"),s("strong",[this._v("同协议，同域名，同端口")]),this._v("的请求地址返回的数据请求。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("正确在服务端配置 "),s("code",[this._v("CORS")]),this._v(" 后的返回数据如下：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(148),alt:"Set-CORS"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(147),alt:"Set-CORS1"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由上图可看出，浏览器在跨域请求后，通过验证 "),s("code",[this._v("Access-Control-Allow-Origin")]),this._v(" 得到允许当前域（"),s("code",[this._v("http://localhost:8889")]),this._v("）跨域请求目标服务器（"),s("code",[this._v("https://api.github.com")]),this._v("）。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("重要")]),this._v("：一般情况下，浏览器并不会阻止跨域请求，但会阻止跨域请求后的数据解析。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"客户端跨域解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端跨域解决方案","aria-hidden":"true"}},[this._v("#")]),this._v(" 客户端跨域解决方案")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("只有在客户端才会存在同源策略，那么可以依据此原理并结合 "),a("code",[t._v("HTML")]),t._v(" 标签的 "),a("code",[t._v("src")]),t._v(" 属性（如 "),a("code",[t._v("script")]),t._v("、"),a("code",[t._v("img")]),t._v("（可能有防盗链措施）、"),a("code",[t._v("link")]),t._v(" 标签）不受客户端同源策略限制，得到以下客户端跨域解决方案：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[t._v("JSONP (JSON with padding)")]),a("ul",[a("li",[t._v("利用 "),a("code",[t._v("script")]),t._v(" 标签的 "),a("code",[t._v("src")]),t._v(" 属性是不受客户端同源策略限制的原理，但必须保证请求源的安全性")])])]),a("li",[a("p",[t._v("目标服务器设置 "),a("code",[t._v("header：Access-Control-Allow-Origin")]),t._v("，即服务端配置 "),a("code",[t._v("CORS")]),t._v(" - "),a("strong",[t._v("趋势")])]),a("ul",[a("li",[t._v("需要客户端和服务端同时支持，若客户端不支持跨域请求，那么即使服务端开启 "),a("code",[t._v("CORS")]),t._v(" 也无济于事")])])]),a("li",[a("p",[t._v("中转服务器代理转发客户端请求")]),a("ul",[a("li",[t._v("利用只有客户端存在同源限制，服务端不存在同源限制的原理")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("拓展")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("利用元素标签的 "),s("code",[this._v("src")]),this._v(" 属性跨域的使用场景：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[a("code",[t._v("img")]),t._v(" 用于统计")])]),a("li",[a("p",[a("code",[t._v("link")]),t._v("、"),a("code",[t._v("script")]),t._v(" 用于 CDN")])]),a("li",[a("p",[a("code",[t._v("script")]),t._v(" 用于 "),a("code",[t._v("JSONP")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"jsonp-实现原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-实现原理","aria-hidden":"true"}},[this._v("#")]),this._v(" JSONP 实现原理")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}},[t._v("\nwindow"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function-variable function"}},[t._v("callBack")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://example.com/api.js?jsonpCallback=callBack"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}}),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("\x3c!-- src 将返回 callBack({ x: 100, y: 200 }) --\x3e")]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[a("code",[t._v("HTML")]),t._v(" 在 "),a("code",[t._v("src")]),t._v(" 请求 JS 脚本后就会立即执行得到的 JS 脚本（除非设置 "),a("code",[t._v("defer")]),t._v(" 属性，表示在下载 JS 同时，不阻塞 DOM 渲染，并延迟至 DOM 树建立后执行）。")])]),a("li",[a("p",[t._v("因为浏览器会默认会将不同的 "),a("code",[t._v("script")]),t._v(" (包含外联 JS 和嵌入式 JS)合并为一个模块。那么，一个 "),a("code",[t._v("document")]),t._v(" 文档内的 "),a("code",[t._v("script")]),t._v(" 标签中 "),a("code",[t._v("src")]),t._v(" 请求的 JS 代码默认（除非设置 "),a("code",[t._v('type="module"')]),t._v(" ，表示当前 JS 脚本文件是一个单独模块）都属于同一模块（都在同一个容器中）。")])]),a("li",[a("p",[a("code",[t._v("JavaScript")]),t._v(" 中圆括号即表示函数调用，如 "),a("code",[t._v("fn()")]),t._v(" 表示调用 "),a("code",[t._v("fn")]),t._v("。")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("示例中，"),s("code",[this._v("JSONP")]),this._v(" 将返回数据作为 "),s("code",[this._v("callBack")]),this._v(" 的参数返回。并且此时执行 "),s("code",[this._v("callBack")]),this._v(" 调用，那么数据得以解析。进而绕过浏览器同源策略。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"jsonp-局限性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jsonp-局限性","aria-hidden":"true"}},[this._v("#")]),this._v(" JSONP 局限性")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[t._v("只支持 "),a("code",[t._v("GET")]),t._v(" 请求。")])]),a("li",[a("p",[t._v("因为是通过 "),a("code",[t._v("HTML")]),t._v(" 标签的 "),a("code",[t._v("src")]),t._v(" 属性来实现跨域的，那么无法验证请求数据的安全性，那么一定要保证请求域的安全性的情况下使用 "),a("code",[t._v("JSONP")]),t._v(" 来实现跨域。")])]),a("li",[a("p",[t._v("必须另外添加计时器来判断请求是否超时。")])])])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._m(1),a("p",[t._v("Ajax 原理如下：")]),t._m(2),a("p",[a("strong",[t._v("注")]),t._v("：根据最新 "),a("a",{attrs:{href:"https://xhr.spec.whatwg.org/#the-open()-method",target:"_blank",rel:"noopener noreferrer"}},[t._v("xhr Standard - open() method"),a("OutboundLink")],1),t._v("，主线程中的同步的 "),a("code",[t._v("XMLHttpRequest")]),t._v(" 已被废弃，默认地，"),a("code",[t._v("open()")]),t._v(" 方法第三参数为 "),a("code",[t._v("true")]),t._v("，即默认异步请求。")]),t._m(3),t._m(4),t._m(5),a("p",[t._v("（以下是重新整理"),a("a",{attrs:{href:"https://lbwa.github.io/2018/04/19/Cross-domain-solution/",target:"_blank",rel:"noopener noreferrer"}},[t._v("我的博客 —— 客户端跨域解决方案"),a("OutboundLink")],1),t._v("）")]),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),a("p",[t._v("前置知识：")]),t._m(24),t._m(25),t._m(26),t._m(27)])},n,!1,null,null,null);s.default=r.exports}}]);