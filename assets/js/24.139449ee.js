(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{159:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"virtual-dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#virtual-dom","aria-hidden":"true"}},[s._v("#")]),s._v(" virtual DOM")]),a("p",[s._v("一般将 "),a("code",[s._v("virtual DOM")]),s._v(" 简写为 "),a("code",[s._v("vdom")]),s._v("。"),a("code",[s._v("vdom")]),s._v(" 的目的是以最优解去更新 "),a("code",[s._v("DOM")]),s._v("，那么就要保证更新节点的查询次数最少（"),a("code",[s._v("vnode")]),s._v("更新节点不需要查询），更新的影响范围最小（依靠 "),a("code",[s._v("vnode.elm")]),s._v(" 精确定位节点）。")]),a("h2",{attrs:{id:"vdom-定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vdom-定义","aria-hidden":"true"}},[s._v("#")]),s._v(" vdom 定义")]),a("ol",[a("li",[a("p",[s._v("含义：用 JS 对象来映射模拟 "),a("code",[s._v("DOM")]),s._v(" 结构")]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("h")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'div'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" id"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'test'")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 生成 vnode")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  children"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" undefined"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// 数组，表示当前节点的 Element 类型子节点的子 vnode")]),s._v("\n  data"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// 当前节点的属性")]),s._v("\n    id"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'data'")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  elm"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" div"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// 映射真实 DOM 树节点，即此处是 vdom 精确更新修改后节点的关键之一")]),s._v("\n  key"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" undefined"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  sel"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'div'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// h() 第一参数，用于创建真实节点")]),s._v("\n  text"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'hello'")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// 当前节点的文本节点，与 children 属性互斥")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])]),a("li",[a("p",[s._v("原理：在 JS 层通过 "),a("code",[s._v("diff")]),s._v(" 算法来对比 "),a("code",[s._v("DOM")]),s._v(" 的结构变化")]),a("ul",[a("li",[a("p",[s._v("浏览器中最"),a("strong",[s._v("耗时")]),s._v("的操作即是 "),a("code",[s._v("DOM")]),s._v(" 操作，直接操作 "),a("code",[s._v("DOM")]),s._v("，将带来巨大的性能开销，所以在没有使用 "),a("code",[s._v("vdom")]),s._v(" 时，需要我们尽可能减少 "),a("code",[s._v("DOM")]),s._v(" 操作。")])]),a("li",[a("p",[s._v("JS 的执行速度"),a("strong",[s._v("远远快于")]),s._v("浏览器 "),a("code",[s._v("DOM")]),s._v(" 渲染速度。所以在 JS 层来处理 "),a("code",[s._v("DOM")]),s._v(" 结构变化将大大降低性能开销。结果将是以"),a("strong",[s._v("最优解")]),s._v("（最小的改动范围，最少的改动次数）去改变 "),a("code",[s._v("DOM")]),s._v(" 结构。")]),a("ul",[a("li",[a("p",[s._v("借助 "),a("code",[s._v("diff")]),s._v(" 算法对比新旧 "),a("code",[s._v("vnode")]),s._v(" 的差异。")])]),a("li",[a("p",[a("code",[s._v("vnode.elm")]),s._v(" 与真实 "),a("code",[s._v("DOM")]),s._v(" 树节点形成映射，进行"),a("strong",[s._v("精准更新")]),s._v("，避免了 "),a("code",[s._v("DOM")]),s._v(" 节点查询。")])])])]),a("li",[a("p",[s._v("前端中只有 JS 是图灵完备语言 —— 能执行算法的语言")])])])]),a("li",[a("p",[s._v("目的：提高重绘性能。即是 "),a("code",[s._v("vdom")]),s._v(" 存在的意义。")])])]),a("h2",{attrs:{id:"vdom-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vdom-api","aria-hidden":"true"}},[s._v("#")]),s._v(" vdom API")]),a("ul",[a("li",[a("p",[s._v("核心：")]),a("ul",[a("li",[a("p",[a("code",[s._v("h")]),s._v(" 函数：生成 "),a("code",[s._v("vnode")]),s._v("。")])]),a("li",[a("p",[a("code",[s._v("patch")]),s._v(" 函数：对比新旧 "),a("code",[s._v("vnode")]),s._v("，并生成或更新 "),a("code",[s._v("DOM")]),s._v(" 节点。")])]),a("li",[a("p",[s._v("API 示例如下：")]),a("div",{staticClass:"language-js line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// const snabbdom = require('sanbbdom')")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'snabbdom'")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" h "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'snabbdom/h'")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_class "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/class'")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_props "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/props'")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_style "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/style'")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" snabbdom_eventlistener "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'snabbdom/modules/eventlistener'")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 初始化 patch")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" patch "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" snabbdom"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("init")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  snabbdom_class"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  snabbdom_props"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  snabbdom_style"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  snabbdom_eventlisteners\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 生成 vnode")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("h")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token template-string"}},[a("span",{attrs:{class:"token string"}},[s._v("`")]),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{attrs:{class:"token comment"}},[s._v("/* 标签名 */")]),a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{attrs:{class:"token string"}},[s._v("`")])]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token comment"}},[s._v("/* 属性 */")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token comment"}},[s._v("/* 子元素 */")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("h")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token template-string"}},[a("span",{attrs:{class:"token string"}},[s._v("`")]),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{attrs:{class:"token comment"}},[s._v("/* 标签名 */")]),a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{attrs:{class:"token string"}},[s._v("`")])]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token comment"}},[s._v("/* 属性 */")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token template-string"}},[a("span",{attrs:{class:"token string"}},[s._v("`")]),a("span",{attrs:{class:"token interpolation"}},[a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{attrs:{class:"token comment"}},[s._v("/* 文本节点 */")]),a("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{attrs:{class:"token string"}},[s._v("`")])]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("div",{staticClass:"highlighted"},[s._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// 容器元素")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" container "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("querySelector")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'#container'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 初次渲染：vnode 初次渲染至 container 容器中")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("patch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 更新节点：利用 js 对比新旧 vnode 来得到操作 DOM 的最优解")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("patch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),a("li",[a("p",[s._v("示例：生成 "),a("code",[s._v("table")]),s._v(" 表格")]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" data "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'name'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    age"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'age'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    address"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'address'")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'John Wick'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    age"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("20")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    address"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'Shanghai'")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("let")]),s._v(" vnode "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// 缓存容器")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("render")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 生成 vnode")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newVnode "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("h")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'table'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("map")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tds "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    Object"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("keys")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("forEach")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key "),a("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      tds"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("push")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("h")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'td'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" item"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("// 返回一个以 tr 元素的 vnode 组成的数组")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("h")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'tr'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tds"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("patch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("patch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 缓存 vnode")]),s._v("\n  vnode "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newVnode\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token function"}},[s._v("render")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])])])])])]),a("p",[s._v("得到表格如下：")]),a("table",[a("thead",[a("tr",[a("th",[s._v("name")]),a("th",[s._v("age")]),a("th",[s._v("address")])])]),a("tbody",[a("tr",[a("td",[s._v("John Wick")]),a("td",[s._v("20")]),a("td",[s._v("Shanghai")])])])]),a("p",[a("code",[s._v("DOM")]),s._v(" 树如下：")]),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("div")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("id")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("container"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("table")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("tr")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("name"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("age"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("address"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("tr")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("tr")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("John Wick"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("20"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n      "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("Shanghai"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("td")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("tr")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("table")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("div")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"diff-算法-——-vdom-核心"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff-算法-——-vdom-核心","aria-hidden":"true"}},[s._v("#")]),s._v(" diff 算法 —— vdom 核心")]),a("ol",[a("li",[a("p",[s._v("定义")]),a("ul",[a("li",[a("p",[a("code",[s._v("linux")]),s._v(" 中的 "),a("code",[s._v("diff")]),s._v(" 命令。")]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("diff")]),s._v(" a.js a1.js\n"),a("span",{attrs:{class:"token comment"}},[s._v("# 将打印 a.js 与 a1.js 的差异")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),a("li",[a("p",[a("code",[s._v("diff")]),s._v(" 算法并非 "),a("code",[s._v("vdom")]),s._v(" 的原创算法。")])])])]),a("li",[a("p",[a("code",[s._v("vdom")]),s._v(" 使用 "),a("code",[s._v("diff")]),s._v(" 算法的原因")]),a("ul",[a("li",[s._v("依靠 "),a("code",[s._v("diff")]),s._v(" 算法，可以"),a("strong",[s._v("找到")]),s._v("新旧 "),a("code",[s._v("vnode")]),s._v(" 中的差异点，即是必须更新的节点（依据 "),a("code",[s._v("vnode.elm")]),s._v(" 得到映射的真实 "),a("code",[s._v("DOM")]),s._v(" 树节点进更新），而其他节点则保持不变。")])])]),a("li",[a("p",[a("code",[s._v("diff")]),s._v(" 算法核心实现流程")]),a("ul",[a("li",[a("p",[s._v("初次渲染，将 "),a("code",[s._v("vnode")]),s._v(" 初次转换成 "),a("code",[s._v("DOM")]),s._v(" 节点")]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("patch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// 仅用于体现转换逻辑，并非真实体现")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("createElement")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" tag "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sel\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" attrs "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data "),a("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" children "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),a("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("tag"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 创建元素")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ele "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("createElement")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("tag"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 设置节点属性")]),s._v("\n  Object"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("keys")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("forEach")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item "),a("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ele"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("setAttribute")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" attrs"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("item"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 插入子元素")]),s._v("\n  children"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("forEach")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode "),a("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("// 递归创建子节点的后代节点（若有的话）")]),s._v("\n    ele"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("appendChild")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("createElement")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 返回真正 DOM 节点")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" ele\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("以上逻辑主要展现 "),a("code",[s._v("vnode")]),s._v(" 的初次渲染。于 "),a("code",[s._v("patch")]),s._v(" 方法中， "),a("code",[s._v("container")]),s._v(" 为渲染容器。")])]),a("li",[a("p",[s._v("渲染更新")]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[s._v("patch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("updateChildren")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" children "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),a("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newChildren "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),a("span",{attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  children"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("forEach")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" index"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newChildVnode "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" newChildren"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("index"),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sel "),a("span",{attrs:{class:"token operator"}},[s._v("===")]),s._v(" newChildVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sel"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token comment"}},[s._v("// 递归子节点的后代节点进行对比")]),s._v("\n      "),a("span",{attrs:{class:"token function"}},[s._v("updateChildren")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode newChildVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token function"}},[s._v("replaceNode")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("childVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newChildVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("replaceNode")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" elm "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("elm\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newElm "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("createElement")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// DOM 替换 ...")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("以上逻辑主要展现 "),a("code",[s._v("vnode")]),s._v(" 更新。在得到 "),a("code",[s._v("newVnode")]),s._v(" 后传入 "),a("code",[s._v("patch")]),s._v(" 函数，"),a("code",[s._v("patch")]),s._v(" 函数将根据 "),a("code",[s._v("diff")]),s._v(" 算法得到 "),a("code",[s._v("vnode")]),s._v(" 与 "),a("code",[s._v("newVnode")]),s._v(" 之间的差异，之后执行精确的 "),a("code",[s._v("DOM")]),s._v(" 更新。")])])])])])])}],!1,null,null,null);t.default=e.exports}}]);